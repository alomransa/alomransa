<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- تعريف الإجراء الجماعي -->
    <record id="action_multi_invoice_process" model="ir.actions.server">
        <field name="name">Multi Invoice Actions</field>
        <field name="model_id" ref="account.model_account_move"/>
        <field name="state">multi</field>
        <field name="binding_model_id" ref="account.model_account_move"/>
        <field name="binding_view_types">list</field>
        <field name="code">
            action = env['account.move'].browse(env.context.get('active_ids'))
            action.action_post()  # يمكنك هنا تحديد الإجراء المناسب مثل post أو غيره
        </field>
    </record>

    <!-- تعديل طريقة عرض الشجرة لإضافة زر الإجراء المتعدد -->
    <record id="account_move_tree_view_inherit_button" model="ir.ui.view">
        <field name="name">account.move.tree.inherit.buttons.multi</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_out_invoice_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//tree" position="inside">
                <button name="%(action_multi_invoice_process)d"
                        string="Process Invoices"
                        type="action"
                        class="oe_highlight"
                        attrs="{'invisible': [('state', '!=', 'draft')]}"/>
            </xpath>
        </field>
    </record>

    <!-- تعديل طريقة عرض فواتير المشتريات -->
    <record id="bill_tree_view_inherit_button" model="ir.ui.view">
        <field name="name">inherit.bill.tree.inherit.button.multi</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_in_invoice_bill_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//tree" position="inside">
                <button name="%(action_multi_invoice_process)d"
                        string="Process Invoices"
                        type="action"
                        class="oe_highlight"
                        attrs="{'invisible': [('state', '!=', 'draft')]}"/>
            </xpath>
        </field>
    </record>
</odoo>
